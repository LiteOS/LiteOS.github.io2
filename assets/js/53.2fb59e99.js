(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{229:function(t,s,a){t.exports=a.p+"assets/img/semaphore-operation.3bf382c8.png"},230:function(t,s){t.exports="data:image/png;base64,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"},797:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"信号量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#信号量","aria-hidden":"true"}},[t._v("#")]),t._v(" 信号量")]),t._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#概述"}},[t._v("概述")]),n("ul",[n("li",[n("a",{attrs:{href:"#基本概念"}},[t._v("基本概念")])]),n("li",[n("a",{attrs:{href:"#运作机制"}},[t._v("运作机制")])])])]),n("li",[n("a",{attrs:{href:"#开发指导"}},[t._v("开发指导")]),n("ul",[n("li",[n("a",{attrs:{href:"#使用场景"}},[t._v("使用场景")])]),n("li",[n("a",{attrs:{href:"#功能"}},[t._v("功能")])]),n("li",[n("a",{attrs:{href:"#开发流程"}},[t._v("开发流程")])])])]),n("li",[n("a",{attrs:{href:"#注意事项"}},[t._v("注意事项")])]),n("li",[n("a",{attrs:{href:"#编程实例"}},[t._v("编程实例")]),n("ul",[n("li",[n("a",{attrs:{href:"#实例描述"}},[t._v("实例描述")])]),n("li",[n("a",{attrs:{href:"#编程示例"}},[t._v("编程示例")])]),n("li",[n("a",{attrs:{href:"#结果验证"}},[t._v("结果验证")])])])])])]),n("p"),t._v(" "),n("h2",{attrs:{id:"概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概述","aria-hidden":"true"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),n("h3",{attrs:{id:"基本概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本概念","aria-hidden":"true"}},[t._v("#")]),t._v(" 基本概念")]),t._v(" "),n("p",[t._v("信号量（Semaphore）是一种实现任务间通信的机制，实现任务之间同步或临界资源的互斥访问。常用于协助一组相互竞争的任务来访问临界资源。")]),t._v(" "),n("p",[t._v("在多任务系统中，各任务之间需要同步或互斥实现临界资源的保护，信号量功能可以为用户提供这方面的支持。")]),t._v(" "),n("p",[t._v("通常一个信号量的计数值用于对应有效的资源数，表示剩下的可被占用的互斥资源数。其值的含义分两种情况：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("0，表示没有积累下来的 Post 操作，且有可能有在此信号量上阻塞的任务。")])]),t._v(" "),n("li",[n("p",[t._v("正值，表示有一个或多个 Post 下来的释放操作。")])])]),t._v(" "),n("p",[t._v("以同步为目的的信号量和以互斥为目的的信号量在使用有如下不同：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("用作互斥时，信号量创建后记数是满的，在需要使用临界资源时，先取信号量，使其变空，这样其他任务需要使用临界资源时就会因为无法取到信号量而阻塞，从而保证了临界资源的安全。")])]),t._v(" "),n("li",[n("p",[t._v("用作同步时，信号量在创建后被置为空，任务1取信号量而阻塞，任务2在某种条件发生后，释放信号量，于是任务1得以进入 READY 或 RUNNING 态，从而达到了两个任务间的同步。")])])]),t._v(" "),n("h3",{attrs:{id:"运作机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#运作机制","aria-hidden":"true"}},[t._v("#")]),t._v(" 运作机制")]),t._v(" "),n("p",[n("strong",[t._v("信号量控制块")])]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("struct")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT16           usSemStat"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),n("span",{attrs:{class:"token comment"}},[t._v("/**是否使用标志位*/")]),t._v("\n    UINT16          uwSemCount"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         "),n("span",{attrs:{class:"token comment"}},[t._v("/**信号量索引号*/")]),t._v("\n    UINT16          usMaxSemCount"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),n("span",{attrs:{class:"token comment"}},[t._v("/**信号量最大数*/")]),t._v("\n    UINT16          usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("            "),n("span",{attrs:{class:"token comment"}},[t._v("/**信号量计数*/")]),t._v("\n    LOS_DL_LIST     stSemList"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),n("span",{attrs:{class:"token comment"}},[t._v("/**挂接阻塞于该信号量的任务*/")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" SEM_CB_S"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n")])])]),n("p",[n("strong",[t._v("信号量运作原理")])]),t._v(" "),n("p",[t._v("信号量初始化，为配置的 N 个信号量申请内存（N值可以由用户自行配置，受内存限制），并把所有的信号量初始化成未使用，并加入到未使用链表中供系统使用。")]),t._v(" "),n("p",[t._v("信号量创建，从未使用的信号量链表中获取一个信号量资源，并设定初值。")]),t._v(" "),n("p",[t._v("信号量申请，若其计数器值大于 0，则直接减 1 返回成功。否则任务阻塞，等待其它任务释放该信号量，等待的超时时间可设定。当任务被一个信号量阻塞时，将该任务挂到信号量等待任务队列的队尾。")]),t._v(" "),n("p",[t._v("信号量释放，若没有任务等待该信号量，则直接将计数器加1返回。否则唤醒该信号量等待任务队列上的第一个任务。")]),t._v(" "),n("p",[t._v("信号量删除，将正在使用的信号量置为未使用信号量，并挂回到未使用链表。")]),t._v(" "),n("p",[t._v("信号量允许多个任务在同一时刻访问同一资源，但会限制同一时刻访问此资源的最大任务数目。访问同一资源的任务数达到该资源的最大数量时，会阻塞其他试图获取该资源的任务，直到有任务释放该信号量。")]),t._v(" "),n("p",[t._v("信号量运作示意图")]),t._v(" "),n("p",[n("img",{attrs:{src:a(229),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"开发指导"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开发指导","aria-hidden":"true"}},[t._v("#")]),t._v(" 开发指导")]),t._v(" "),n("h3",{attrs:{id:"使用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用场景","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用场景")]),t._v(" "),n("p",[t._v("信号量是一种非常灵活的同步方式，可以运用在多种场合中，实现锁、同步、资源计数等功能，也能方便的用于任务与任务，中断与任务的同步中。")]),t._v(" "),n("h3",{attrs:{id:"功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#功能","aria-hidden":"true"}},[t._v("#")]),t._v(" 功能")]),t._v(" "),n("p",[t._v("Huawei LiteOS 系统中的信号量模块为用户提供下面几种功能。")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("功能分类")]),t._v(" "),n("th",[t._v("接口名")]),t._v(" "),n("th",[t._v("描述")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("信号量的创建和删除")]),t._v(" "),n("td",[t._v("LOS_SemCreate")]),t._v(" "),n("td",[t._v("创建信号量")])]),t._v(" "),n("tr",[n("td"),t._v(" "),n("td",[t._v("LOS_BinarySemCreate")]),t._v(" "),n("td",[t._v("创建二进制信号量")])]),t._v(" "),n("tr",[n("td"),t._v(" "),n("td",[t._v("LOS_SemDelete")]),t._v(" "),n("td",[t._v("删除指定的信号量")])]),t._v(" "),n("tr",[n("td",[t._v("信号量的申请和释放")]),t._v(" "),n("td",[t._v("LOS_SemPend")]),t._v(" "),n("td",[t._v("申请指定的信号量")])]),t._v(" "),n("tr",[n("td"),t._v(" "),n("td",[t._v("LOS_SemPost")]),t._v(" "),n("td",[t._v("释放指定的信号量")])])])]),t._v(" "),n("h3",{attrs:{id:"开发流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开发流程","aria-hidden":"true"}},[t._v("#")]),t._v(" 开发流程")]),t._v(" "),n("p",[t._v("信号量的开发典型流程：")]),t._v(" "),n("ol",[n("li",[n("p",[n("strong",[t._v("创建信号量")]),t._v(" "),n("code",[t._v("LOS_SemCreate")]),t._v("。")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("申请信号量")]),t._v(" "),n("code",[t._v("LOS_SemPend")]),t._v("。")]),t._v(" "),n("p",[t._v("信号量有三种申请模式：无阻塞模式、永久阻塞模式、定时阻塞模式")]),t._v(" "),n("ul",[n("li",[n("p",[n("strong",[t._v("无阻塞模式")]),t._v("：任务需要申请信号量，若当前信号量的任务数没有到信号量设定的上限，则申请成功。否则，立即返回申请失败")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("永久阻塞模式")]),t._v("：任务需要申请信号量，若当前信号量的任务数没有到信号量设定的上限，则申请成功。否则，该任务进入阻塞态，系统切换到就绪任务中优先级最高者继续执行。任务进入阻塞态后，直到有其他任务释放该信号量，阻塞任务才会重新得以执行")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("定时阻塞模式")]),t._v("：任务需要申请信号量，若当前信号量的任务数没有到信号量设定的上限，则申请成功。否则，该任务进入阻塞态，系统切换到就绪任务中优先级最高者继续执行。任务进入阻塞态后，指定时间超时前有其他任务释放该信号量，或者用户指定时间超时后，阻塞任务才会重新得以执行")])])])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("释放信号量")]),t._v(" "),n("code",[t._v("LOS_SemPost")]),t._v("。")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("如果有任务阻塞于指定信号量，则唤醒该信号量阻塞队列上的第一个任务。该任务进入就绪态，并进行调度")])]),t._v(" "),n("li",[n("p",[t._v("如果没有任务阻塞于指定信号量，释放信号量成功")])])])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("删除信号量")]),t._v(" "),n("code",[t._v("LOS_SemDelete")]),t._v("。")])])]),t._v(" "),n("h2",{attrs:{id:"注意事项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意事项","aria-hidden":"true"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),n("ul",[n("li",[t._v("由于中断不能被阻塞，因此在申请信号量时，阻塞模式不能在中断中使用。")])]),t._v(" "),n("h2",{attrs:{id:"编程实例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编程实例","aria-hidden":"true"}},[t._v("#")]),t._v(" 编程实例")]),t._v(" "),n("h3",{attrs:{id:"实例描述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实例描述","aria-hidden":"true"}},[t._v("#")]),t._v(" 实例描述")]),t._v(" "),n("p",[t._v("本实例实现如下功能：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("测试任务 "),n("code",[t._v("Example_TaskEntry")]),t._v(" 创建一个信号量，锁任务调度，创建两个任务 "),n("code",[t._v("Example_SemTask1")]),t._v("、"),n("code",[t._v("Example_SemTask2")]),t._v(", "),n("code",[t._v("Example_SemTask2")]),t._v("优先级高于 "),n("code",[t._v("Example_SemTask1")]),t._v("，两个任务中申请同一信号量，解锁任务调度后两任务阻塞，测试任务 "),n("code",[t._v("Example_TaskEntry")]),t._v(" 释放信号量。")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("Example_SemTask2")]),t._v(" 得到信号量，被调度，然后任务休眠 20Tick，"),n("code",[t._v("Example_SemTask2")]),t._v(" 延迟，"),n("code",[t._v("Example_SemTask1")]),t._v(" 被唤醒。")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("Example_SemTask1")]),t._v(" 定时阻塞模式申请信号量，等待时间为10Tick，因信号量仍被 "),n("code",[t._v("Example_SemTask2")]),t._v(" 持有，"),n("code",[t._v("Example_SemTask1")]),t._v(" 挂起，10Tick 后仍未得到信号量，"),n("code",[t._v("Example_SemTask1")]),t._v(" 被唤醒，试图以永久阻塞模式申请信号量，"),n("code",[t._v("Example_SemTask1")]),t._v(" 挂起。")])]),t._v(" "),n("li",[n("p",[t._v("20Tick 后 "),n("code",[t._v("Example_SemTask2")]),t._v(" 唤醒， 释放信号量后，"),n("code",[t._v("Example_SemTask1")]),t._v(" 得到信号量被调度运行，最后释放信号量。")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("Example_SemTask1")]),t._v(" 执行完，40Tick 后任务 "),n("code",[t._v("Example_TaskEntry")]),t._v(" 被唤醒。")])])]),t._v(" "),n("h3",{attrs:{id:"编程示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编程示例","aria-hidden":"true"}},[t._v("#")]),t._v(" 编程示例")]),t._v(" "),n("p",[t._v("前提条件：")]),t._v(" "),n("p",[t._v("在 "),n("code",[t._v("los_config.h")]),t._v(" 中，将 "),n("code",[t._v("LOSCFG_BASE_IPC_SEM")]),t._v(" 配置为 YES。")]),t._v(" "),n("p",[t._v("配置用户定义的 "),n("code",[t._v("LOSCFG_BASE_IPC_SEM_LIMIT")]),t._v(" 最大的信号量数，如 1024。")]),t._v(" "),n("p",[t._v("代码实现如下：")]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/*测试任务优先级*/")]),t._v("\n"),n("span",{attrs:{class:"token macro property"}},[t._v("#"),n("span",{attrs:{class:"token directive keyword"}},[t._v("define")]),t._v(" TASK_PRIO_TEST  5")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("/*任务PID*/")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" UINT32 g_TestTaskID01"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("g_TestTaskID02"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("/*信号量结构体ID*/")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" UINT32 g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" VOID "),n("span",{attrs:{class:"token function"}},[t._v("Example_SemTask1")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("void")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT32 uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask1 try get sem g_usSemID ,timeout 10 ticks.\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/*定时阻塞模式申请信号量，定时时间为10Tick*/")]),t._v("\n    uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("10")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/*申请到信号量*/")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPost")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/*定时时间到，未申请到信号量*/")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_ERRNO_SEM_TIMEOUT "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask1 timeout and try get sem g_usSemID wait forever.\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token comment"}},[t._v("/*永久阻塞模式申请信号量,获取不到时程序阻塞，不会返回*/")]),t._v("\n        uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LOS_WAIT_FOREVER"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask1 wait_forever and got sem g_usSemID success.\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPost")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_InspectStatusSetByID")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_INSPECT_SEM"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("LOS_INSPECT_STU_SUCCESS"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Set Inspect Status Err\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" VOID "),n("span",{attrs:{class:"token function"}},[t._v("Example_SemTask2")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("void")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT32 uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask2 try get sem g_usSemID wait forever.\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/*永久阻塞模式申请信号量*/")]),t._v("\n    uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LOS_WAIT_FOREVER"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask2 get sem g_usSemID and then delay 20ticks .\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/*任务休眠20 Tick*/")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskDelay")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token number"}},[t._v("20")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask2 post sem g_usSemID .\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/*释放信号量*/")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPost")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nUINT32 "),n("span",{attrs:{class:"token function"}},[t._v("Example_Semphore")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("VOID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT32 uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    TSK_INIT_PARAM_S stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    TSK_INIT_PARAM_S stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),n("span",{attrs:{class:"token comment"}},[t._v("/*创建信号量*/")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemCreate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/*锁任务调度*/")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskLock")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/*创建任务1*/")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("memset")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_INIT_PARAM_S"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pfnTaskEntry "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_ENTRY_FUNC"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("Example_SemTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pcName       "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"MutexTsk1"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uwStackSize  "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOSCFG_BASE_CORE_TSK_IDLE_STACK_SIZE"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("usTaskPrio   "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" TASK_PRIO_TEST"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskCreate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("g_TestTaskID01"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"task1 create failed .\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" LOS_NOK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/*创建任务2*/")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("memset")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_INIT_PARAM_S"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pfnTaskEntry "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_ENTRY_FUNC"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("Example_SemTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pcName       "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"MutexTsk2"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uwStackSize  "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOSCFG_BASE_CORE_TSK_IDLE_STACK_SIZE"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("usTaskPrio   "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TASK_PRIO_TEST "),n("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("1")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskCreate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("g_TestTaskID02"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"task2 create failed .\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),n("span",{attrs:{class:"token comment"}},[t._v("/*删除任务1*/")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskDelete")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_TestTaskID01"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"task1 delete failed .\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        \n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" LOS_NOK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/*解锁任务调度*/")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskUnlock")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPost")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/*任务休眠40 Tick*/")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskDelay")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token number"}},[t._v("40")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/*删除信号量*/")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemDelete")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n")])])]),n("h3",{attrs:{id:"结果验证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#结果验证","aria-hidden":"true"}},[t._v("#")]),t._v(" 结果验证")]),t._v(" "),n("p",[t._v("编译运行得到的结果为：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(230),alt:""}})])])}],_=a(0),e=Object(_.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);e.options.__file="semaphore.md";s.default=e.exports}}]);