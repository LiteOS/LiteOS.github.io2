(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{206:function(t,s,a){t.exports=a.p+"assets/img/semaphore-operation.3bf382c8.png"},207:function(t,s){t.exports="data:image/png;base64,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"},636:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"semaphore"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#semaphore","aria-hidden":"true"}},[t._v("#")]),t._v(" Semaphore")]),t._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#overview"}},[t._v("Overview")]),n("ul",[n("li",[n("a",{attrs:{href:"#basic-concept"}},[t._v("Basic Concept")])]),n("li",[n("a",{attrs:{href:"#operation-mechanism"}},[t._v("Operation Mechanism")])])])]),n("li",[n("a",{attrs:{href:"#development-guidelines"}},[t._v("Development Guidelines")]),n("ul",[n("li",[n("a",{attrs:{href:"#usage-scenarios"}},[t._v("Usage Scenarios")])]),n("li",[n("a",{attrs:{href:"#functions"}},[t._v("Functions")])]),n("li",[n("a",{attrs:{href:"#development-process"}},[t._v("Development Process")])])])]),n("li",[n("a",{attrs:{href:"#precautions"}},[t._v("Precautions")])]),n("li",[n("a",{attrs:{href:"#programming-example"}},[t._v("Programming Example")]),n("ul",[n("li",[n("a",{attrs:{href:"#example-description"}},[t._v("Example Description")])]),n("li",[n("a",{attrs:{href:"#example-code"}},[t._v("Example Code")])]),n("li",[n("a",{attrs:{href:"#verification"}},[t._v("Verification")])])])])])]),n("p"),t._v(" "),n("h2",{attrs:{id:"overview"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#overview","aria-hidden":"true"}},[t._v("#")]),t._v(" Overview")]),t._v(" "),n("h3",{attrs:{id:"basic-concept"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#basic-concept","aria-hidden":"true"}},[t._v("#")]),t._v(" Basic Concept")]),t._v(" "),n("p",[t._v("A semaphore is a mechanism used for communication within a kernel, to achieve synchronization or mutual exclusion of critical resources between tasks.")]),t._v(" "),n("p",[t._v("In a multi-task system, it is necessary to synchronize one task with another or prevent tasks battling for critical resources. Semaphores are a good choice to serve that purpose.")]),t._v(" "),n("p",[t._v("Typically, a numerical value of a signal is used to correspond to the number of available resources. It means mutually exclusive resources remained that could be occupied. The meaning of its value is divided into two kinds of situations:")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("0, it means the post operation that is not accumulated, and it is possible to block tasks on this signal.")])]),t._v(" "),n("li",[n("p",[t._v("Positive number, it means there is one or several release operations which are posted.")])])]),t._v(" "),n("p",[t._v("The differences to use between semaphore for the purpose of synchronization and semaphore for the purpose of mutex are:")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("If a semaphore is used as a mutex, it is created with a full internal counter. Each time a task waits on critical resources, it is assigned the semaphore and the counter value is decreased by 1. When the counter value drops to 0, subsequent tasks are blocked from getting the semaphore.")])]),t._v(" "),n("li",[n("p",[t._v("If a semaphore is used for task synchronization, it is created with an empty counter. When task 1 attempts to get the semaphore, it is blocked because the counter has reached the maximum value. Task 1 will enter Ready or Running state after task 2 releases the semaphore, thereby achieving task synchronization.")])])]),t._v(" "),n("h3",{attrs:{id:"operation-mechanism"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#operation-mechanism","aria-hidden":"true"}},[t._v("#")]),t._v(" Operation Mechanism")]),t._v(" "),n("p",[n("strong",[t._v("Semaphore Control Block")])]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/**\n * @ingroup los_sem\n * Semaphore control structure.\n */")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("struct")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT8           usSemStat"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),n("span",{attrs:{class:"token comment"}},[t._v("/**whether to use flag bit*/")]),t._v("\n    UINT16          uwSemCount"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         "),n("span",{attrs:{class:"token comment"}},[t._v("/**semaphore quantity index*/")]),t._v("\n    UINT32UINT16    usMaxSemCount"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),n("span",{attrs:{class:"token comment"}},[t._v("/**Maximum number of semaphores*/")]),t._v("\n    UINT32          usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("            "),n("span",{attrs:{class:"token comment"}},[t._v("/**semaphore count*/")]),t._v("\n    LOS_DL_LIST     stSemList"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),n("span",{attrs:{class:"token comment"}},[t._v("/**suspend the task blocked on the semaphore*/")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("SEM_CB_S"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[n("strong",[t._v("Semaphore Operation Principle")])]),t._v(" "),n("p",[t._v("During semaphore initialization, memory is allocated to N semaphores. N is configurable by users and limited by memory. All semaphores are initialized and added to the linked list of semaphores that are not in use.")]),t._v(" "),n("p",[t._v("During semaphore creation, a semaphore is obtained from the linked list of semaphores that are not in use and the initial value of the semaphore is set.")]),t._v(" "),n("p",[t._v("If the internal counter of a semaphore is more than 0 when the semaphore is pended, the counter value is decreased by 1 and the pending succeeds. If the counter value is 0, tasks are blocked from getting the semaphore and wait for other tasks to post the semaphore. The timeout interval of waiting on the semaphore can be configured. If a task is blocked from getting the semaphore, suspend the task to the tail of the queue of tasks waiting on the semaphore.")]),t._v(" "),n("p",[t._v("If no tasks are waiting on a semaphore, the counter value is increased by 1 and the semaphore is posted. Otherwise, wake up the first task in the queue of tasks waiting on the semaphore.")]),t._v(" "),n("p",[t._v("During semaphore deletion, the semaphore that is in use is set to be not in use and is added to the linked list of semaphores that are not in use.")]),t._v(" "),n("p",[t._v("A semaphore allows multiple tasks to access the same resource at the same time but sets a limit on the number of the tasks. Tasks are not allowed to access the resource if the maximum number of the tasks that can access the resource is reached and need to wait for one task to release the semaphore.")]),t._v(" "),n("p",[t._v("Working principle of semaphore")]),t._v(" "),n("p",[n("img",{attrs:{src:a(206),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"development-guidelines"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#development-guidelines","aria-hidden":"true"}},[t._v("#")]),t._v(" Development Guidelines")]),t._v(" "),n("h3",{attrs:{id:"usage-scenarios"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#usage-scenarios","aria-hidden":"true"}},[t._v("#")]),t._v(" Usage Scenarios")]),t._v(" "),n("p",[t._v("Semaphores find their use in locking resources, counting resources, and maintaining synchronization between threads or between threads and interrupts.")]),t._v(" "),n("h3",{attrs:{id:"functions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#functions","aria-hidden":"true"}},[t._v("#")]),t._v(" Functions")]),t._v(" "),n("p",[t._v("The semaphore module provides the following functions:")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("Function Category")]),t._v(" "),n("th",[t._v("API")]),t._v(" "),n("th",[t._v("Description")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("Semaphore creation and deletion")]),t._v(" "),n("td",[n("code",[t._v("LOS_SemCreate")])]),t._v(" "),n("td",[t._v("Creates a semaphore")])]),t._v(" "),n("tr",[n("td"),t._v(" "),n("td",[n("code",[t._v("LOS_BinarySemCreate")])]),t._v(" "),n("td",[t._v("Creates a binary semaphore")])]),t._v(" "),n("tr",[n("td"),t._v(" "),n("td",[n("code",[t._v("LOS_SemDelete")])]),t._v(" "),n("td",[t._v("Deletes a semaphore")])]),t._v(" "),n("tr",[n("td",[t._v("Semaphore pend and post")]),t._v(" "),n("td",[n("code",[t._v("LOS_SemPend")])]),t._v(" "),n("td",[t._v("Pends on a semaphore")])]),t._v(" "),n("tr",[n("td"),t._v(" "),n("td",[n("code",[t._v("LOS_SemPost")])]),t._v(" "),n("td",[t._v("Posts a semaphore")])])])]),t._v(" "),n("h3",{attrs:{id:"development-process"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#development-process","aria-hidden":"true"}},[t._v("#")]),t._v(" Development Process")]),t._v(" "),n("p",[t._v("Semaphore typical development process:")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("Call the "),n("code",[t._v("LOS_SemCreate")]),t._v(" API to create a semaphore.")])]),t._v(" "),n("li",[n("p",[t._v("Call the "),n("code",[t._v("LOS_SemPend")]),t._v(" to pend on a semaphore.")])])]),t._v(" "),n("p",[t._v("Huawei LiteOS takes actions depending on the semaphore pend mode.")]),t._v(" "),n("ul",[n("li",[n("p",[n("strong",[t._v("Non-blocking mode")]),t._v(": If the maximum number of tasks allowed by the semaphore is not reached, the request for the semaphore is fulfilled. Otherwise, the request for the semaphore is rejected.")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("Permanent blocking mode")]),t._v(": The requesting task waits endlessly for a semaphore and the task enters Blocked state in the meantime. If the maximum number of tasks allowed by the semaphore is not reached, the request for the semaphore is fulfilled. Otherwise, the operating system blocks the requesting task until a task releases the semaphore. It then selects the ready task with the highest priority to be executed.")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("Temporary blocking mode")]),t._v(": the requesting task waits for a specified period of time for a semaphore and enters Blocked state in the meantime. If the maximum number of tasks allowed by the semaphore is not reached, the request for the semaphore is fulfilled. Otherwise, the operating system blocks the requesting task until a task releases the semaphore or the timeout period elapses. It then selects the ready task with the highest priority to be executed.")])])]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("Call the "),n("code",[t._v("LOS_SemPost")]),t._v(" API to post a semaphore.")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("If there are tasks blocked from acquiring the semaphore, the operating system wakes up the first blocked task. The woken-up task then enters Ready state and is scheduled.")])]),t._v(" "),n("li",[n("p",[t._v("If there are no tasks blocked from acquiring the semaphore, the operating system posts the semaphore.")])])]),t._v(" "),n("ol",{attrs:{start:"4"}},[n("li",[t._v("Call the "),n("code",[t._v("LOS_SemDelete")]),t._v(" API to delete a semaphore.")])]),t._v(" "),n("h2",{attrs:{id:"precautions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#precautions","aria-hidden":"true"}},[t._v("#")]),t._v(" Precautions")]),t._v(" "),n("ul",[n("li",[t._v("As interrupts cannot be blocked, permanent blocking and temporary blocking are not allowed for interrupts during the request for a semaphore.")])]),t._v(" "),n("h2",{attrs:{id:"programming-example"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#programming-example","aria-hidden":"true"}},[t._v("#")]),t._v(" Programming Example")]),t._v(" "),n("h3",{attrs:{id:"example-description"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#example-description","aria-hidden":"true"}},[t._v("#")]),t._v(" Example Description")]),t._v(" "),n("p",[t._v("In the programming example, the following activities will happen:")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("The "),n("code",[t._v("Example_TaskEntry")]),t._v(" task is executed to create a semaphore. Task scheduling is locked. Two tasks "),n("code",[t._v("Example_SemTask1")]),t._v(" and "),n("code",[t._v("Example_SemTask2")]),t._v(" are created, where "),n("code",[t._v("Example_SemTask2")]),t._v(" takes a higher priority than "),n("code",[t._v("Example_SemTask1")]),t._v(". Then, task scheduling is unlocked. "),n("code",[t._v("Example_TaskEntry")]),t._v(" releases the semaphore.")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("Example_SemTask2")]),t._v(" is granted the semaphore, scheduled, and sent to sleep mode for 20 ticks. While "),n("code",[t._v("Example_SemTask2")]),t._v(" is delayed, "),n("code",[t._v("Example_SemTask1")]),t._v(" is woken up.")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("Example_SemTask1")]),t._v(" pends on the semaphore and is willing to wait the semaphore for 10 ticks to become free. At the time when "),n("code",[t._v("Example_SemTask1")]),t._v(" requests the semaphore, the semaphore is held by "),n("code",[t._v("Example_SemTask2")]),t._v(" and consequently "),n("code",[t._v("Example_SemTask1")]),t._v(" is suspended. After the 10-tick wait period elapses, the semaphore is still out of the reach of "),n("code",[t._v("Example_SemTask1")]),t._v(", and "),n("code",[t._v("Example_SemTask1")]),t._v(" is woken up, attempting to wait permanently for the semaphore. The wait for semaphore switches "),n("code",[t._v("Example_SemTask1")]),t._v(" to suspended state.")])]),t._v(" "),n("li",[n("p",[t._v("After 20 ticks, "),n("code",[t._v("Example_SemTask2")]),t._v(" is woken up and releases the semaphore. "),n("code",[t._v("Example_SemTask1")]),t._v(" is scheduled, granted the semaphore, and finally releases it.")])]),t._v(" "),n("li",[n("p",[t._v("40 ticks after "),n("code",[t._v("Example_SemTask1")]),t._v(" is finished, Example_TaskEntry is woken up, deletes the semaphore and then the two tasks.")])])]),t._v(" "),n("h3",{attrs:{id:"example-code"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#example-code","aria-hidden":"true"}},[t._v("#")]),t._v(" Example Code")]),t._v(" "),n("p",[t._v("Prerequisites")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("The "),n("code",[t._v("LOSCFG_BASE_IPC_SEM")]),t._v(" parameter in the "),n("code",[t._v("los_config.h")]),t._v(" file is set to YES.")])]),t._v(" "),n("li",[n("p",[t._v("The "),n("code",[t._v("LOSCFG_BASE_IPC_SEM_LIMIT")]),t._v(" parameter in the "),n("code",[t._v("los_config.h")]),t._v(" file is set to the maximum number (for example, 1024) of semaphores that the operating system allows.")])])]),t._v(" "),n("p",[t._v("The code is as follows:")]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/* task pid */")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" UINT32 g_TestTaskID01"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" g_TestTaskID02"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("/* sem id */")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" UINT32 g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" VOID "),n("span",{attrs:{class:"token function"}},[t._v("Example_SemTask1")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("VOID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT32 uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask1 try get sem g_usSemID ,timeout 10 ticks.\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* get sem, timeout is 10 ticks */")]),t._v("\n    uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("10")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* get sem ok */")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPost")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* timeout, get sem fail */")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_ERRNO_SEM_TIMEOUT "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask1 timeout and try get sem g_usSemID wait forever.\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token comment"}},[t._v("/* get sem wait forever, LOS_SemPend return until has been get mux */")]),t._v("\n        uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LOS_WAIT_FOREVER"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask1 wait_forever and got sem g_usSemID success.\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPost")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_InspectStatusSetByID")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_INSPECT_SEM"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LOS_INSPECT_STU_SUCCESS"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Set Inspect Status Err\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" VOID "),n("span",{attrs:{class:"token function"}},[t._v("Example_SemTask2")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("VOID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT32 uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask2 try get sem g_usSemID wait forever.\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* wait forever get sem */")]),t._v("\n    uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LOS_WAIT_FOREVER"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask2 get sem g_usSemID and then delay 20ticks .\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* task delay 20 ticks */")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskDelay")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token number"}},[t._v("20")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask2 post sem g_usSemID .\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* release sem */")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPost")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nUINT32 "),n("span",{attrs:{class:"token function"}},[t._v("Example_Semphore")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("VOID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT32 uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    TSK_INIT_PARAM_S stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    TSK_INIT_PARAM_S stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),n("span",{attrs:{class:"token comment"}},[t._v("/* create sem */")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemCreate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* lock task schedue */")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskLock")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* create task1 */")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("memset")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_INIT_PARAM_S"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pfnTaskEntry "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_ENTRY_FUNC"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("Example_SemTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pcName       "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"MutexTsk1"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uwStackSize  "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOSCFG_BASE_CORE_TSK_IDLE_STACK_SIZE"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("usTaskPrio   "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" TASK_PRIO_TEST"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskCreate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("g_TestTaskID01"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask1"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"task1 create failed .\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" LOS_NOK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* create task2 */")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("memset")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_INIT_PARAM_S"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pfnTaskEntry "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_ENTRY_FUNC"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("Example_SemTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pcName       "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"MutexTsk2"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uwStackSize  "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOSCFG_BASE_CORE_TSK_IDLE_STACK_SIZE"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("usTaskPrio   "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TASK_PRIO_TEST "),n("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("1")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskCreate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("g_TestTaskID02"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask2"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"task2 create failed .\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{attrs:{class:"token comment"}},[t._v("/* delete task 1 */")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskDelete")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_TestTaskID01"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token function"}},[t._v("dprintf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"task1 delete failed .\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" LOS_NOK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* unlock task schedue */")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskUnlock")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    uwRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemPost")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* task delay 40 ticks */")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskDelay")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token number"}},[t._v("40")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* delete sem */")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SemDelete")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" uwRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"verification"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#verification","aria-hidden":"true"}},[t._v("#")]),t._v(" Verification")]),t._v(" "),n("p",[t._v("The verification result is as follows:")]),t._v(" "),n("p",[n("img",{attrs:{src:a(207),alt:""}})])])}],e=a(0),o=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);o.options.__file="semaphore.md";s.default=o.exports}}]);